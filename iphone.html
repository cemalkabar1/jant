<!DOCTYPE html>
<html lang="tr">
<head>
    <!-- Mevcut head i√ßeriƒüi aynƒ± kalacak -->
    <style>
        /* Yeni eklenen stil */
        .file-source-buttons {
            display: none;
            position: fixed;
            bottom: 100px;
            left: 20px;
            right: 20px;
            background: white;
            border-radius: 14px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
        }
        .source-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            background: #f2f2f7;
            border: none;
            border-radius: 10px;
            font-size: 16px;
        }
        .close-source {
            position: absolute;
            top: 10px;
            right: 10px;
            border: none;
            background: none;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <!-- Mevcut body i√ßeriƒüi aynƒ± -->

    <!-- Yeni eklenen galeri se√ßim aray√ºz√º -->
    <div class="file-source-buttons" id="fileSourceButtons">
        <button class="close-source" id="closeSource">√ó</button>
        <button class="source-btn" id="takePhotoBtn">üì∑ Kamera ile √áek</button>
        <button class="source-btn" id="chooseFromGalleryBtn">üñºÔ∏è Galeriden Se√ß</button>
    </div>

    <script>
        // Yeni eklenen fonksiyonlar
        const showFileSourceOptions = (type) => {
            const sourceButtons = document.getElementById('fileSourceButtons');
            sourceButtons.style.display = 'block';
            
            document.getElementById('closeSource').onclick = () => {
                sourceButtons.style.display = 'none';
            };
            
            document.getElementById('takePhotoBtn').onclick = () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.capture = 'environment';
                input.onchange = (e) => handleFileUpload(e, type);
                input.click();
                sourceButtons.style.display = 'none';
            };
            
            document.getElementById('chooseFromGalleryBtn').onclick = () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = (e) => handleFileUpload(e, type);
                input.click();
                sourceButtons.style.display = 'none';
            };
        };

        // Mevcut butonlarƒ± g√ºncelleme
        document.getElementById('car-upload').onclick = (e) => {
            e.preventDefault();
            showFileSourceOptions('car');
        };
        
        // Wheel upload i√ßin eski mantƒ±k korunsun
        document.getElementById('wheel-upload').onclick = (e) => {
            e.preventDefault();
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => handleFileUpload(e, 'wheel');
            input.click();
        };

        // Handle File Upload fonksiyonu (mevcut kodda zaten var)
        const handleFileUpload = (event, type) => {
            const file = event.target.files[0];
            if (!file) return;
            
            const status = document.getElementById('status-message');
            status.textContent = type === 'car' ? 'Ara√ß y√ºkleniyor...' : 'Jant y√ºkleniyor...';
            status.style.color = '#007AFF';
            
            const reader = new FileReader();
            reader.onload = (e) => {
                fabric.Image.fromURL(e.target.result, (img) => {
                    if (type === 'car') {
                        const scale = Math.min(
                            canvas.width * 0.9 / img.width,
                            canvas.height * 0.7 / img.height
                        );
                        img.scale(scale).set({
                            left: canvas.width / 2,
                            top: canvas.height / 2,
                            originX: 'center',
                            originY: 'center',
                            selectable: false
                        });
                        canvas.setBackgroundImage(img, () => canvas.renderAll());
                    } else {
                        const targetSize = Math.min(canvas.width, canvas.height) * 0.35;
                        const scale = targetSize / Math.max(img.width, img.height);
                        img.scale(scale).set({
                            left: canvas.width / 2,
                            top: canvas.height / 2,
                            originX: 'center',
                            originY: 'center',
                            angle: 0,
                            hasControls: true,
                            cornerStyle: 'circle',
                            cornerColor: '#FF9500',
                            cornerSize: 12,
                            transparentCorners: false
                        });
                        if (canvas.getActiveObject()) canvas.discardActiveObject();
                        canvas.add(img).setActiveObject(img);
                    }
                    status.textContent = type === 'car' ? 'Ara√ß y√ºklendi!' : 'Jant y√ºklendi!';
                    status.style.color = '#34C759';
                }, { crossOrigin: 'anonymous' });
            };
            reader.onerror = () => {
                status.textContent = 'Y√ºkleme hatasƒ±!';
                status.style.color = '#FF3B30';
            };
            reader.readAsDataURL(file);
        };
    </script>
</body>
</html>
